{"version":3,"file":"runtime-core.global.js","sources":["../../shared/src/index.ts","../src/componentPublicInstance.ts","../src/components.ts","../src/vnode.ts","../src/apicreateApp.ts","../../reactivity/src/effect.ts","../../reactivity/src/baseHandlers.ts","../../reactivity/src/reactive.ts","../src/render.ts","../src/h.ts"],"sourcesContent":["export const isObject = (val) => typeof val === 'object' && val !== null\r\n\r\nexport const assign = (val1, val2) => Object.assign(val1, val2)\r\n\r\nexport const isArray = (val) => Array.isArray(val)\r\nexport const isNumber = (val) => typeof val === 'number'\r\nexport const isString = (val) => typeof val === 'string'\r\nexport const isFunction = (val) => typeof val === 'function'\r\n\r\nexport const isIntegerKey = (val) => parseInt(val) + '' === val\r\n\r\nconst hasOwn = Object.prototype.hasOwnProperty\r\nexport const hasOwnProperty = (target, key) => hasOwn.call(target, key)\r\n\r\nexport const isChanged = (oldValue, newValue) => oldValue !== newValue\r\n\r\nexport { ShapeFlags } from './shapeFlags'\r\n","import { hasOwnProperty } from '@vue3-mini/shared'\r\n\r\nexport const PublicInstanceProxyHandlers = {\r\n  get({ _: instance }, key) {\r\n    const { setupState, props, data } = instance\r\n    if (hasOwnProperty(setupState, key)) {\r\n      return setupState[key]\r\n    } else if (hasOwnProperty(props, key)) {\r\n      return props[key]\r\n    } else if (hasOwnProperty(data, key)) {\r\n      return data[key]\r\n    } else {\r\n      return undefined\r\n    }\r\n  },\r\n  set({ _: instance }, key, value) {\r\n    const { setupState, props, data } = instance\r\n    if (hasOwnProperty(setupState, key)) {\r\n      setupState[key] = value\r\n    } else if (hasOwnProperty(props, key)) {\r\n      props[key] = value\r\n    } else if (hasOwnProperty(data, key)) {\r\n      data[key] = value\r\n    }\r\n  },\r\n}\r\n","import { isFunction, isObject, ShapeFlags } from '@vue3-mini/shared'\r\nimport { PublicInstanceProxyHandlers } from './componentPublicInstance'\r\n// 组件的方法\r\n\r\nexport const createComponentInstance = (vnode) => {\r\n  //webcomponent 组件需要有属性、插槽\r\n  const instance = {\r\n    //组件实例\r\n    vnode,\r\n    type: vnode.type,\r\n    props: {},\r\n    attrs: {},\r\n    ctx: {},\r\n    slots: {},\r\n    setupState: {}, // 如果setup返回是一个对象 将作为setupState的值\r\n    render: null,\r\n    isMounted: false, //是否被挂载\r\n  }\r\n  instance.ctx = { _: instance }\r\n  return instance\r\n}\r\n\r\nexport const setupComponent = (instance) => {\r\n  const { props, children } = instance.vnode\r\n  instance.props = props // initProps\r\n  instance.children = children //initSlot 插槽的解析\r\n  // 先判断当前组件是不是有状态的组件 函数组件\r\n  const isStateful = instance.vnode.shapeFlag & ShapeFlags.STATEFUL_COMPONENT\r\n  if (isStateful) {\r\n    // 有状态的组件\r\n    // 调用组件的setup方法  拿到返回值填充setupState和render\r\n    setupStatefulComonent(instance)\r\n  }\r\n}\r\n\r\nfunction setupStatefulComonent(instance) {\r\n  // 1.代理 render方法里参数为proxy 但是可以直接访问到instance的各种属性 代理一层\r\n  instance.proxy = new Proxy(instance.ctx, PublicInstanceProxyHandlers as any)\r\n  //2.获取组件类型  调用setup\r\n  const component = instance.type\r\n  const { setup } = component\r\n  if (setup) {\r\n    const setupContext = createSetupContext(instance)\r\n    const setupResult = setup(instance.props, setupContext)\r\n    handleSeupResult(instance, setupResult)\r\n  } else {\r\n    finishComponentSetup(instance)\r\n  }\r\n\r\n  // component.render(instance.proxy)\r\n}\r\n\r\nfunction handleSeupResult(instance, setupResult) {\r\n  if (isFunction(setupResult)) {\r\n    instance.render = setupResult\r\n  } else if (isObject(setupResult)) {\r\n    instance.setupState = setupResult\r\n  }\r\n}\r\n\r\nfunction finishComponentSetup(instance) {\r\n  const component = instance.type\r\n  if (!instance.render) {\r\n    // 对模板进行编译 生成render函数\r\n    if (!component.render && component.template) {\r\n      // 编译结果赋值给render\r\n    }\r\n  }\r\n  // 对vue2.x兼容处理 applyOptions 遍历\r\n}\r\n\r\nfunction createSetupContext(instance) {\r\n  return {\r\n    attrs: instance.attrs,\r\n    props: instance.props,\r\n    slots: instance.slots,\r\n    emit: () => {\r\n      //\r\n    },\r\n    expose: () => {\r\n      //\r\n    },\r\n  }\r\n}\r\n","import { isArray, isObject, isString, ShapeFlags } from '@vue3-mini/shared'\r\n\r\nexport const isVNode = (vnode) => vnode.__v_isVnode\r\n\r\nexport const createVNode = (type, props, children = null) => {\r\n  // 用来描述对应的内容  虚拟节点具有跨平台的能力\r\n  const shapeFlag = isString(type)\r\n    ? ShapeFlags.ELEMENT // dom\r\n    : isObject(type)\r\n    ? ShapeFlags.STATEFUL_COMPONENT // component\r\n    : 0\r\n  const vnode = {\r\n    __v_isVnode: true, //是一个虚拟节点\r\n    type,\r\n    props,\r\n    children,\r\n    el: null, // 会将虚拟节点跟真实节点对应\r\n    key: props && props.key,\r\n    shapeFlag, // 判断自己的类型和儿子的类型\r\n  }\r\n  normalizeChildren(vnode, children)\r\n  return vnode\r\n}\r\n\r\nfunction normalizeChildren(vnode, children) {\r\n  let type = 0\r\n  if (children === null) {\r\n    console.log()\r\n  } else if (isArray(children)) {\r\n    type = ShapeFlags.ARRAY_CHILDREN\r\n  } else {\r\n    type = ShapeFlags.TEXT_CHILDREN\r\n  }\r\n  vnode.shapeFlag |= type\r\n}\r\n","import { createVNode } from './vnode'\r\n\r\nexport function createAppAPI(render) {\r\n  return function createApp(rootComponent, rootProps) {\r\n    const app = {\r\n      _props: rootProps,\r\n      _component: rootComponent,\r\n      _container: null,\r\n      mount: function (container) {\r\n        //1.创建虚拟节点\r\n        const vnode = createVNode(rootComponent, rootProps)\r\n        //2.渲染\r\n        render(vnode, container)\r\n        app._container = container\r\n      },\r\n    }\r\n    return app\r\n  }\r\n}\r\n","import { isArray, isIntegerKey } from '@vue3-mini/shared'\r\nimport { TriggerOpTypes } from './operators'\r\n\r\nfunction effect(fn, options: any = {}) {\r\n  // 创建一个响应的effect,依赖变化时重新执行副作用\r\n  const effect = createReactiveEffect(fn, options)\r\n  if (!options.lazy) {\r\n    // 默认执行一次\r\n    effect()\r\n  }\r\n  return effect\r\n}\r\n\r\nlet uid = 0\r\nlet activeEffect // 当前的effect\r\nconst effectStack = [] // effect栈数组\r\nfunction createReactiveEffect(fn, options) {\r\n  const effect = function reactiveEffect() {\r\n    /**\r\n     * 当effect有嵌套关系时  可能会错误的引用当前的activeEffect\r\n     * 利用栈 先进后出  当副作用执行完   更新activeEffect为栈数组的最后一项\r\n     */\r\n    if (!effectStack.includes(effect)) {\r\n      // 防止重复添加\r\n      try {\r\n        activeEffect = effect\r\n        effectStack.push(activeEffect)\r\n        return fn()\r\n      } finally {\r\n        effectStack.pop()\r\n        activeEffect = effectStack[effectStack.length - 1]\r\n      }\r\n    }\r\n  }\r\n  effect.id = uid++ // 区分effect的唯一标识\r\n  effect._isEffect = true // 标记响应式的effect\r\n  effect.raw = fn // 副作用\r\n  effect.options = options // 参数配置\r\n  return effect\r\n}\r\n\r\n/**\r\n * target key effect对应数据结构关系\r\n * target --> key --> effect 例：{name:'c',age:12} --> name --> [effect1,effect2]\r\n * targetsMap\r\n * targetsMap --> target1 --> key --> effect\r\n */\r\n\r\nconst targetsMap = new WeakMap()\r\n// 依赖收集\r\nfunction track(target, type, key) {\r\n  if (activeEffect === undefined || activeEffect === null) return\r\n  // 拿到targetsMap对应target的Map集合 {key:Set}\r\n  let depsMap = targetsMap.get(target)\r\n  if (!depsMap) {\r\n    targetsMap.set(target, (depsMap = new Map()))\r\n  }\r\n  // 拿到targetMap对应的key的Set集合 Set\r\n  let depMap = depsMap.get(key)\r\n  if (!depMap) {\r\n    depsMap.set(key, (depMap = new Set()))\r\n  }\r\n  if (!depMap.has(activeEffect)) {\r\n    depMap.add(activeEffect)\r\n  }\r\n  // console.log('ta', targetsMap)\r\n}\r\n// 依赖触发更新\r\nfunction trigger(target, type, key?, value?, oldValue?) {\r\n  // console.log('key', target, type, key, value, oldValue)\r\n  const depsMap = targetsMap.get(target)\r\n  console.log('3', targetsMap)\r\n  if (!depsMap) return // 没有收集过effect依赖直接返回\r\n\r\n  // 创建一个集合 统一执行副作用  去重\r\n  const effects = new Set()\r\n  const addEffect = (depMap) => {\r\n    depMap && depMap.forEach((effect) => effects.add(effect))\r\n  }\r\n\r\n  /**\r\n   * 查看修改的是否是数组且修改的是否是数组长度\r\n   * q: 数据使用可能会使用到数组的长度、取数组某个下标值\r\n   * r: 当更新数组的长度的时候  对应的数组长度的依赖和下标依赖也应该更新\r\n   */\r\n  if (isArray(target) && key === 'length') {\r\n    depsMap.forEach((dep, key) => {\r\n      // console.log('111', dep, key)\r\n      /**\r\n       * 查找收集过的key是否符合条件\r\n       * 1. obj.arr.length 当修改数组长度时候收集过的arr.length需要改变\r\n       * 2. obj.arr[2] 当修改数组长度时候收集过的key也就是对应的index值大于修改的数组长度value时(数组变短)需要改变\r\n       */\r\n      if (key > value || key === 'length') {\r\n        addEffect(dep)\r\n      }\r\n    })\r\n  } else {\r\n    if (key !== undefined) {\r\n      // 修改某个key\r\n      addEffect(depsMap.get(key))\r\n    }\r\n    switch (type) {\r\n      // 修改数组的某一个索引 当使用obj.arr时内部会自动收集length属性(对数组转成字符串调用toString,toString就会取得数组length)\r\n      case TriggerOpTypes.ADD:\r\n        if (isArray(target) && isIntegerKey(key)) {\r\n          addEffect(depsMap.get('length'))\r\n        }\r\n\r\n        break\r\n    }\r\n  }\r\n\r\n  effects.forEach((effect: any) => {\r\n    if (effect.options.scheduler) {\r\n      effect.options.scheduler()\r\n    } else {\r\n      effect()\r\n    }\r\n  })\r\n}\r\n\r\nexport { effect, track, trigger }\r\n","// 实现new proxy(target, handlers)\r\n\r\nimport {\r\n  assign,\r\n  isObject,\r\n  isArray,\r\n  isIntegerKey,\r\n  hasOwnProperty,\r\n  isChanged,\r\n} from '@vue3-mini/shared'\r\nimport { track, trigger } from './effect'\r\nimport { TrackOpTypes, TriggerOpTypes } from './operators'\r\nimport { reactive, readonly } from './reactive'\r\n\r\n/**\r\n * proxy + Reflect\r\n * Refect优势：\r\n *    r1: 后续Object上的方法会迁徙到Reflect上,例如Object.getProptypeof()\r\n *    r2: 以前的obj[key]设置值可能会失败，并不会报异常，也没有设置状态标识，Reflect方法会有一个状态标识true/false\r\n */\r\nfunction createGetter(isReadonly = false, isShallow = false) {\r\n  return function get(target, key, receiver) {\r\n    const res = Reflect.get(target, key)\r\n    if (!isReadonly) {\r\n      // 收集依赖\r\n      track(target, TrackOpTypes.GET, key)\r\n    }\r\n    if (isShallow) return res\r\n    /**\r\n     * vue2的代理模式是一上来就递归对象的key代理，深度遍历对象，性能不好\r\n     * vue3是当读取对象的key时才会触发代理,懒代理\r\n     */\r\n    if (isObject(res)) {\r\n      return isReadonly ? readonly(res) : reactive(res)\r\n    }\r\n    return res\r\n  }\r\n}\r\n\r\nfunction createSetter(isShallow = false) {\r\n  // console.log('222')\r\n  return function set(target, key, value, receiver) {\r\n    const oldVlaue = target[key]\r\n    const hasKey =\r\n      isArray(target) && isIntegerKey(key)\r\n        ? Number(key) < target.length\r\n        : hasOwnProperty(target, key)\r\n    const result = Reflect.set(target, key, value, receiver)\r\n    if (!hasKey) {\r\n      //新增\r\n      trigger(target, TriggerOpTypes.ADD, key, value)\r\n    } else if (isChanged(oldVlaue, value)) {\r\n      // 修改\r\n      trigger(target, TriggerOpTypes.SET, key, value, oldVlaue)\r\n    }\r\n\r\n    return result\r\n  }\r\n}\r\n\r\nconst get = createGetter()\r\nconst shallowGet = createGetter(false, true)\r\nconst readonlyGet = createGetter(true)\r\nconst shallowReadonlyGet = createGetter(true, true)\r\n\r\nconst set = createSetter()\r\nconst shallowSet = createSetter(true)\r\n\r\nconst readonlyObj = {\r\n  set() {\r\n    return console.warn(`key in readonly`)\r\n  },\r\n}\r\n\r\nconst mutableHandles = {\r\n  get,\r\n  set,\r\n}\r\nconst shallowReactiveHandlers = {\r\n  get: shallowGet,\r\n  set: shallowSet,\r\n}\r\nconst readonlyHandlers = assign(\r\n  {\r\n    get: readonlyGet,\r\n  },\r\n  readonlyObj,\r\n)\r\nconst shallowReadonlyHandlers = assign(\r\n  {\r\n    get: shallowReadonlyGet,\r\n  },\r\n  readonlyObj,\r\n)\r\n\r\nexport {\r\n  mutableHandles,\r\n  shallowReadonlyHandlers,\r\n  readonlyHandlers,\r\n  shallowReactiveHandlers,\r\n}\r\n","import { isObject } from '@vue3-mini/shared'\r\nimport {\r\n  shallowReactiveHandlers,\r\n  shallowReadonlyHandlers,\r\n  readonlyHandlers,\r\n  mutableHandles,\r\n} from './baseHandlers'\r\n\r\nfunction reactive(target) {\r\n  return createReactiveObject(target, false, mutableHandles)\r\n}\r\nfunction shallowReactive(target) {\r\n  return createReactiveObject(target, false, shallowReactiveHandlers)\r\n}\r\nfunction shallowReadonly(target) {\r\n  return createReactiveObject(target, true, shallowReadonlyHandlers)\r\n}\r\nfunction readonly(target) {\r\n  return createReactiveObject(target, true, readonlyHandlers)\r\n}\r\n\r\n/**\r\n * 是不是仅读  是不是深度  柯里化\r\n * new Proxy() 最核心的还是拦截  数据的读取和修改 get set\r\n */\r\nconst reactiveMap = new WeakMap() // 自动垃圾回收 不会造成内存泄漏，key是一个对象\r\nconst readonlyMap = new WeakMap()\r\nfunction createReactiveObject(target, isReadonly, baseHandlers) {\r\n  // 只代理对象\r\n  if (!isObject(target)) return target\r\n  const proxyMap = isReadonly ? readonlyMap : reactiveMap\r\n  // 已经被代理过了不需要被代理\r\n  const existProxy = proxyMap.get(target)\r\n  if (existProxy) return existProxy\r\n  // 将代理对象缓存\r\n  const proxy = new Proxy(target, baseHandlers)\r\n  proxyMap.set(target, proxy)\r\n  return proxy\r\n}\r\n\r\nexport { reactive, shallowReactive, shallowReadonly, readonly }\r\n","import { createComponentInstance, setupComponent } from './components'\r\nimport { ShapeFlags } from '@vue3-mini/shared'\r\n/**\r\n * 渲染流程\r\n * 1. 将组件转化成虚拟dom\r\n * 2. 将虚拟dom转换成真实dom\r\n */\r\n\r\nimport { createAppAPI } from './apicreateApp'\r\nimport { effect } from '@vue3-mini/reactivity'\r\n\r\nexport function createRender(renderOptions) {\r\n  const {\r\n    createElement: hostCreateElement,\r\n    remove: hostRemove,\r\n    insert: hostInsert,\r\n    querySelector: hostQuerySelector,\r\n    setElementText: hostSetElementText,\r\n    createText: hostCreateText,\r\n    setText: hostSetText,\r\n    patchProps: hostPatchProps,\r\n  } = renderOptions\r\n  // -----------组件start---------\r\n  const setupRenderEffect = (instance, container) => {\r\n    //需要创建一个effect 在effect中调用render方法，这样render方法中拿到的数据会收集这个effect，属性更新时effect重新执行\r\n    //每个组件都会有一个effect vue3是组件级更新 数据重新变化重新执行组件的effect\r\n    effect(function componentEffect() {\r\n      if (!instance.isMounted) {\r\n        // 初次渲染\r\n        const proxyToUse = instance.proxy\r\n        // 2.x $vnode _vnode\r\n        // 组件是vnode 真正渲染内容subTree\r\n        const subTree = (instance.subTree = instance.render.call(\r\n          proxyToUse,\r\n          proxyToUse,\r\n        ))\r\n        patch(null, subTree, container)\r\n        instance.isMounted = true\r\n      } else {\r\n        // 更新\r\n      }\r\n    })\r\n  }\r\n  const mountComponent = (initalVNode, container) => {\r\n    /**\r\n     * 组件渲染流程最核心的就是调用setup拿到返回值 获取render方法的返回结果\r\n     * 1. 创建实例\r\n     * 2. 需要的数据解析到实例上\r\n     * 3. 创建一个effect 让render函数执行  render函数本身就是一个effect 依赖变化要重新执行\r\n     */\r\n    // 1. 创建实例\r\n    const instance = (initalVNode.component =\r\n      createComponentInstance(initalVNode))\r\n    // 2. 需要的数据解析到实例上\r\n    setupComponent(instance)\r\n    // 3. 创建一个effect 让render函数执行  render函数本身就是一个effect 依赖变化要重新执行\r\n    setupRenderEffect(instance, container)\r\n  }\r\n  const processComponent = (oldVale, newVal, container) => {\r\n    if (oldVale === null) {\r\n      // 旧的没有 创建\r\n      mountComponent(newVal, container)\r\n    } else {\r\n      // 更新\r\n    }\r\n  }\r\n  //-------------组件end---------\r\n  // ----------元素start----------\r\n  const mountElement = (vnode, container) => {\r\n    const { type, props, shapeFlag, children } = vnode\r\n    const el = (vnode.el = hostCreateElement(type))\r\n    if (props) {\r\n      for (const key in props) {\r\n        hostPatchProps(el, key, null, props[key])\r\n      }\r\n    }\r\n    hostInsert(el, container)\r\n  }\r\n  const processElement = (oldValue, newValue, container) => {\r\n    if (oldValue === null) {\r\n      mountElement(newValue, container)\r\n    }\r\n  }\r\n  // ----------元素end----------\r\n  const patch = (oldVal, newVal, container) => {\r\n    // 这里做判断组件类别\r\n    const { shapeFlag } = newVal\r\n    if (shapeFlag & ShapeFlags.ELEMENT) {\r\n      // 元素\r\n      processElement(oldVal, newVal, container)\r\n    } else if (shapeFlag & ShapeFlags.STATEFUL_COMPONENT) {\r\n      // 组件\r\n      processComponent(oldVal, newVal, container)\r\n    }\r\n  }\r\n  const render = (vnode, container) => {\r\n    console.log(vnode, container)\r\n    patch(null, vnode, container)\r\n  }\r\n  return {\r\n    createApp: createAppAPI(render),\r\n  }\r\n}\r\n","import { isVNode, createVNode } from './vnode'\r\nimport { isArray, isObject } from '@vue3-mini/shared'\r\n\r\nexport function h(type, propsOrChildren, children) {\r\n  const l = arguments.length\r\n  if (l === 2) {\r\n    // 类型 + 属性/孩子\r\n    if (isObject(propsOrChildren) && !isArray(propsOrChildren)) {\r\n      if (isVNode(propsOrChildren)) {\r\n        return createVNode(type, null, [propsOrChildren])\r\n      }\r\n      return createVNode(type, propsOrChildren)\r\n    } else {\r\n      return createVNode(type, null, propsOrChildren)\r\n    }\r\n  } else {\r\n    if (l > 3) {\r\n      // eslint-disable-next-line prefer-rest-params\r\n      children = Array.prototype.slice.call(arguments, 2)\r\n    } else if (l === 3 && isVNode(children)) {\r\n      children = [children]\r\n    }\r\n    return createVNode(type, propsOrChildren, children)\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}